### Requirements

- **Installation**

    Create a Conda environment and install dependencies:
    ```bash
    conda create -n datvil python=3.7
    conda activate datvil
    pip install -r requirements.txt
    conda install pytorch torchvision cudatoolkit=11.8 -c pytorch -c nvidia
    ```

- **Dataset**

    Follow [this link](https://github.com/KaiyangZhou/CoOp/blob/main/DATASETS.md) to install all datasets.

- **Class-specific Attributes and Context-aware Descriptions**

    All class-specific attributes and context-aware descriptions generated by GPT-4 are available in the folders "attributes_gpt4" and "attributes_discriminative_gpt4". Copy these folders to the datasets root directory.

### How to Run

    **DATViL**

    - For ImageNet dataset:
        ```bash
        python main_imagenet.py --config configs/imagenet.yaml --model_name datvil --root_path ./data
        ```

    - For other datasets:
        ```bash
        python main.py --config configs/dataset.yaml --model_name datvil --root_path ./data
        ```

    - Replace "root_path" with the path to the root folder of all datasets.

    **Update Context-aware Descriptions**

    Under different training settings, a trained DATViL model may result in selecting slightly different candidate classes for each test sample. Before training DATViL-C, use the following code to update the context-aware descriptions:

    ```bash
    python extract_gpt4.py --labels_file dataset_labels.json --description_file dataset.json --dataset dataset
    ```

    - Replace "labels_file" with the path to the labels file saved by DATViL.
    - "description_file" is the path to the provided context-aware descriptions in the folder "attributes_discriminative_gpt4".
    - Replace "dataset" with the dataset name.

    **Note**: Set your OpenAI key in "extract_gpt4.py".

    **DATViL-C**

    - For ImageNet dataset:
        ```bash
        python main_imagenet.py --config ./configs/imagenet.yaml --model_name datvilc --root_path ./data
        ```

    - For other datasets:
        ```bash
        python main.py --config configs/dataset.yaml --model_name datvilc --root_path ./data
        ```

    - Replace "root_path" with the path to the root folder of all datasets.

- **Additional Settings**

    For running DATViL and DATViL-C, adjust the training settings using the following arguments:

    - `"shots"`: Number of shots used for training.
    - `"per_sample_train"`: Number of per-sample training epochs in DATViL-C.
    
    Alpha and beta values, backbone type, and learning rates can be changed in dataset config files available in `./configs/`.
